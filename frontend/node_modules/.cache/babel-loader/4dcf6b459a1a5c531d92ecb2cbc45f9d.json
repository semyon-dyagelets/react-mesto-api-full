{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"/Users/SD/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/SD/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import Header from\"./Header.js\";import Main from\"./Main.js\";import Footer from\"./Footer.js\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import ImagePopup from\"./ImagePopup.js\";import AddPlacePopup from\"./AddPlacePopup\";import Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute\";import InfoTooltip from\"./InfoTooltip\";import api from\"../utils/api.js\";import*as auth from\"../utils/auth.js\";import{CurrentUserContext}from\"../contexts/CurrentUserContext.js\";import{Redirect,Route,Switch,useHistory}from\"react-router-dom\";function App(){var initialData={email:\"\",password:\"\"};var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),cards=_React$useState2[0],setCards=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isEditAvatarPopupOpen=_React$useState8[0],setIsEditAvatarPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipOpen=_React$useState10[0],setIsInfoTooltipOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),selectedCard=_React$useState12[0],setSelectedCard=_React$useState12[1];var _React$useState13=React.useState(\"\"),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState(initialData),_React$useState18=_slicedToArray(_React$useState17,2),email=_React$useState18[0],setEmail=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),isRegistrationSuccessed=_React$useState20[0],setIsRegistrationSuccessed=_React$useState20[1];var history=useHistory();React.useEffect(function(){api.getUserInfo().then(function(userInfo){setCurrentUser(userInfo);}).catch(function(err){console.log(err);});},[]);React.useEffect(function(){api.getInitialCards().then(function(cardsData){setCards(cardsData);}).catch(function(err){console.log(err);});},[]);function handleUpdateUser(data){api.editProfile(data).then(function(newUser){setCurrentUser(newUser);closeAllPopups();}).catch(function(err){console.log(err);});}function handleUpdateAvatar(link){api.editAvatar(link).then(function(newLink){setCurrentUser(newLink);closeAllPopups();}).catch(function(err){console.log(err);});}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setSelectedCard(card);}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});var likeRequest=!isLiked?api.putLike(card._id):api.deleteLike(card._id);likeRequest.then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);}).catch(function(err){console.log(err);});}function handleAddPlaceSubmit(data){api.addCard(data).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard(false);setIsInfoTooltipOpen(false);}var handleLogin=function handleLogin(_ref){var email=_ref.email,password=_ref.password;return auth.authorize(email,password).then(function(res){if(res.token){setLoggedIn(true);setEmail(email);history.push(\"/\");localStorage.setItem(\"jwt\",res.token);}}).catch(function(err){console.log(err);});};var tokenCheck=React.useCallback(function(){var token=localStorage.getItem(\"jwt\");if(token){auth.checkToken(token).then(function(res){if(res){setLoggedIn(true);setEmail(res.data.email);}history.push(\"/\");}).catch(function(){return history.push(\"/sign-in\");});}},[history]);React.useEffect(function(){tokenCheck();},[tokenCheck]);var handleRegister=function handleRegister(_ref2){var email=_ref2.email,password=_ref2.password;return auth.register(email,password).then(function(res){setIsRegistrationSuccessed(true);setIsInfoTooltipOpen(true);history.push(\"/sign-in\");return res;}).catch(function(err){setIsInfoTooltipOpen(true);console.log(err);});};var handleSignOut=function handleSignOut(){localStorage.removeItem(\"jwt\");setEmail(initialData);setLoggedIn(false);history.push(\"/login\");};return/*#__PURE__*/_jsx(\"div\",{className:\"body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,onSignOut:handleSignOut,email:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin,tokenCheck:tokenCheck})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/\",loggedIn:loggedIn,component:Main,onSignOut:handleSignOut,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,isSuccessed:isRegistrationSuccessed,onClose:closeAllPopups})]})})});}export default App;","map":{"version":3,"sources":["/Users/SD/Desktop/dev/react-mesto-auth/src/components/App.js"],"names":["React","Header","Main","Footer","EditProfilePopup","EditAvatarPopup","ImagePopup","AddPlacePopup","Login","Register","ProtectedRoute","InfoTooltip","api","auth","CurrentUserContext","Redirect","Route","Switch","useHistory","App","initialData","email","password","useState","cards","setCards","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","loggedIn","setLoggedIn","setEmail","isRegistrationSuccessed","setIsRegistrationSuccessed","history","useEffect","getUserInfo","then","userInfo","catch","err","console","log","getInitialCards","cardsData","handleUpdateUser","data","editProfile","newUser","closeAllPopups","handleUpdateAvatar","link","editAvatar","newLink","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleCardLike","isLiked","likes","some","i","_id","likeRequest","putLike","deleteLike","newCard","newCards","map","c","handleCardDelete","deleteCard","filter","handleAddPlaceSubmit","addCard","handleLogin","authorize","res","token","push","localStorage","setItem","tokenCheck","useCallback","getItem","checkToken","handleRegister","register","handleSignOut","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Header from \"./Header.js\";\nimport Main from \"./Main.js\";\nimport Footer from \"./Footer.js\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport ImagePopup from \"./ImagePopup.js\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport api from \"../utils/api.js\";\nimport * as auth from \"../utils/auth.js\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport { Redirect, Route, Switch, useHistory } from \"react-router-dom\";\n\nfunction App() {\n\n  const initialData = {\n    email: \"\",\n    password: \"\"\n  }\n  const [cards, setCards] = React.useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(false);\n  const [currentUser, setCurrentUser] = React.useState(\"\");\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [email, setEmail] = React.useState(initialData);\n  const [isRegistrationSuccessed, setIsRegistrationSuccessed] = React.useState(false);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    api\n      .getUserInfo()\n      .then((userInfo) => {\n        setCurrentUser(userInfo);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  React.useEffect(() => {\n    api\n      .getInitialCards()\n      .then((cardsData) => {\n        setCards(cardsData);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  function handleUpdateUser(data) {\n    api\n      .editProfile(data)\n      .then((newUser) => {\n        setCurrentUser(newUser);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleUpdateAvatar(link) {\n    api\n      .editAvatar(link)\n      .then((newLink) => {\n        setCurrentUser(newLink);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n    const likeRequest = !isLiked\n      ? api.putLike(card._id)\n      : api.deleteLike(card._id);\n    likeRequest.then((newCard) => {\n      const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n      setCards(newCards);\n    });\n  }\n\n  function handleCardDelete(card) {\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleAddPlaceSubmit(data) {\n    api\n      .addCard(data)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard(false);\n    setIsInfoTooltipOpen(false);\n  }\n\n  const handleLogin = ({email, password}) => {\n    return auth.authorize(email, password)\n    .then(res => {\n      if (res.token) {\n        setLoggedIn(true);\n        setEmail(email);\n        history.push(\"/\");\n        localStorage.setItem(\"jwt\", res.token);\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  }\n\n  const tokenCheck = React.useCallback(() => {\n    const token = localStorage.getItem(\"jwt\");\n    if (token) {\n      auth.checkToken(token)\n      .then((res) => {\n        if(res) {\n          setLoggedIn(true);\n          setEmail(res.data.email);\n        }\n        history.push(\"/\")\n      })\n      .catch(() => history.push(\"/sign-in\"))\n    }\n  }, [history])\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, [tokenCheck])\n\n\n  const handleRegister = ({email, password}) => {\n    return auth.register(email, password)\n    .then(res => {\n      setIsRegistrationSuccessed(true);\n      setIsInfoTooltipOpen(true);\n      history.push(\"/sign-in\");\n      return res;\n    })\n    .catch((err) => {\n      setIsInfoTooltipOpen(true)\n      console.log(err);\n    })\n  }\n\n  const handleSignOut = () => {\n    localStorage.removeItem(\"jwt\");\n    setEmail(initialData);\n    setLoggedIn(false);\n    history.push(\"/login\");\n  }\n\n  return (\n    <div className=\"body\">\n      <div className=\"page\">\n        <CurrentUserContext.Provider value={currentUser}>\n          <Header loggedIn={loggedIn} onSignOut={handleSignOut} email={email} />\n\n          <Switch>\n            <Route path=\"/sign-in\">\n              <Login onLogin={handleLogin} tokenCheck={tokenCheck} />\n            </Route>\n\n            <Route path=\"/sign-up\">\n              <Register onRegister={handleRegister} />\n            </Route>\n\n            <ProtectedRoute\n              path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              onSignOut={handleSignOut}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n              cards={cards}\n            />\n\n            <Route>\n              {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n            </Route>\n          </Switch>\n\n          <Footer />\n\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n\n          <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n\n          <InfoTooltip\n            isOpen={isInfoTooltipOpen}\n            isSuccessed={isRegistrationSuccessed}\n            onClose={closeAllPopups}\n          />\n        </CurrentUserContext.Provider>\n      </div>\n    </div>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}